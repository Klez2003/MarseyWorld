{%- extends 'root.html' -%}
{% block body_attributes %}id="{% if request.path != '/comments' %}{% block pagetype %}frontpage{% endblock %}{% endif %}" class="has_header"{% endblock %}
{% block body %}
{% block pulltorefresh %}
<div id="pulltorefresh">
	<img id="pulltorefresh-img" src="{{SITE_FULL_IMAGES}}/e/marseyunamused.webp">
</div>
{% endblock %}
{% block banner %}
	{% include "modals/expanded_image.html" %}
	{% if err or '@' not in request.path %}
		{% if IS_FISTMAS() and not sub %}
			{% include 'events/fistmas/banner.html' %}
		{% else %}
			{% if err and SITE_NAME == 'rDrama' %}
				{% set src = "banner_error.webp" | asset_siteimg %}
			{% elif sub and sub.has_banners %}
				{% set src = sub.random_banner() %}
				{% set alt = ['/h/', sub, 'banner']|join %}
				{% set class = 'site-banner-hole' %}
			{% elif IS_EVENT() %}
				{% set src = macros.random_image("assets/events/" ~ IS_EVENT() ~ "/images/banners") %}
			{% elif SITE_NAME == "rDrama" %}
				{% set href = "https://secure.transequality.org/site/Donation2?df_id=1480" %}
				{% set expand = false %}
			{% endif %}

			{% if SITE_NAME == "WPD" %}
				{% if sub %}
					{% set href = "/h/" ~ sub %}
					{% set expand = false %}
				{% else %}
					{% set href = "/" %}
					{% set expand = false %}
				{% endif %}
			{% endif %}

			<a id="banner-link" href="{{href|default(src)}}" rel="nofollow noopener">
				{% if src %}
					{% set banner_url = src %}
				{% else %}
					{% set path = "files/assets/images/" ~ SITE_NAME %}

					{%- if not v and os_path.exists(path ~ "/cached.webp") -%}
						{% set banner_url = 'cached.webp' | asset_siteimg %}
					{% elif os_path.exists(path ~ "/banners") -%}
						{% set banner_url = SITE_FULL_IMAGES ~ macros.random_image("assets/images/" ~ SITE_NAME ~ "/banners") %}
					{% else -%}
						{% set banner_url = 'banner.webp' | asset_siteimg %}
					{% endif %}
				{% endif %}

				{% macro img_element() %}
					<img data-nonce="{{g.nonce}}" data-onclick="{{expand|default('expandImage()')}}" class="{{class|default('site-banner')}}" alt="{{alt|default('site banner')}}" src="{{banner_url}}">
				{% endmacro %}

				{% if sub and sub.has_banners %}
					{{img_element()}}
				{% else %}
					<div class="banner-wrapper">
						<div style="padding: 0 0 12.2%">
							<div>
								{{img_element()}}
							</div>
						</div>
					</div>
				{% endif %}
			</a>
		{% endif %}
	{% endif %}
{% endblock %}

{% include "header.html" %}
{% block mobileUserBanner %}{% endblock %}
<div class="container">
	<div class="row justify-content-around" id="main-content-row">
		{% block sidebar %}
			{% if has_sidebar and (home or p) %}
				{% set sidebar = "sidebar_" ~ SITE_NAME ~ ".html" %}
				{% include sidebar %}
			{% endif %}
		{% endblock %}
		<div class="order-first col h-100 {% block customPadding %}{% if request.path.startswith('/@') %}user-gutters{% else %}custom-gutters{% endif %}{% endblock %}" id="main-content-col">
			{% block desktopUserBanner %}{% endblock %}
			{% block desktopBanner %}{% endblock %}
			{% block PseudoSubmitForm %}{% endblock %}
			{% block searchText %}{% endblock %}
			{% block content %}{% endblock %}
			{% block pagenav %}{% endblock %}
		</div>
	</div>
</div>
{% block mobilenavbar %}{% include "mobile_navigation_bar.html" %}{% endblock %}
{% block actionsModal %}{% endblock %}
{% block reportCommentModal %}{% endblock %}
{% block GIFtoast %}{% endblock %}
{% block GIFpicker %}{% endblock %}
<div class="toast clipboard" id="toast-success" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body text-center">
		<i class="fas fa-check-circle text-success mr-2"></i>Link copied to clipboard
	</div>
</div>
<script defer src="{{'js/vendor/lozad.js' | asset}}"></script>
<script defer src="{{'js/vendor/lite-youtube.js' | asset}}"></script>

{% if (v and v.spider) or (p and p.award_count("shit", v)) or (p and p.award_count("fireflies", v)) %}
	<script defer src="{{'js/vendor/critters.js' | asset}}"></script>

	{% if v and v.spider %}
		<script defer src="{{'js/spider.js' | asset}}"></script>
	{% endif %}

	{% if p and p.award_count("shit", v) %}
		<input hidden id="shit_num" value="{{p.award_count('shit', v)}}">
		<script defer src="{{'js/bugs.js' | asset}}"></script>
	{% endif %}

	{% if p and p.award_count("fireflies", v) %}
		<input hidden id="fireflies_num" value="{{p.award_count('fireflies', v)}}">
		<script defer src="{{'js/fireflies.js' | asset}}"></script>
	{% endif %}
{% endif %}

{% if IS_DKD() %}
	{% include "events/DKD/music.html" %}
{% elif IS_FISTMAS() %}
	{% include "events/fistmas/music.html" %}
{% endif %}

{% endblock %}
